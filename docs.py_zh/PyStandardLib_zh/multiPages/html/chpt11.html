<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Python Standard Library</TITLE>

<!-- Included style.css -->
<STYLE TYPE="text/css">
body, td, {
	font-family: verdana, sans-serif;
	font-size: 12px;
}

body {
	background-color: #FDFBFC;
	margin:20px 20px 20px 20px;
}


p {
	margin-top:10px;
	margin-bottom:10px;
}

a {font-weight:normal; text-decoration:underline;}
a:link {color:#0000FF;}
a:visited {color:#0000FF;}
a:active {color:#0000FF;}
a:hover {color:#700000;}

strong a {
    font-weight: bold;
}

.toc {
	background-color: #EEEEFB;
	border: 1px solid;
	/*padding:10px 8px 10px 15px;*/
	float : right ; width : 37%;
	margin : 5px; padding: 5px;
	margin: 5px;
}

.toc a:link , .toc a:visited  { color : #003399; }

.toc a:hover { 
	color : #EEEEFB;
	text-decoration : none;
	background-color: black;
}

.trailbold {
	font-weight:bold;
}

.light {
	background-color: #EFEFEF;
}

.dark {
	background-color: #D2D2D2;
}

.smalllogo {
	float:left;
}

.headerbar {
	padding-bottom:60px;
}
	
.header {
	font-weight: bold;
	font-size: 20px;
}

.smallheader {
	font-weight: bold;
	font-size: 16px;
}

.filelist {
	font-size:14px;
	margin: 10px 10px 10px 70px;
	line-height:25px;
}

.dirheader {
	font-size:13px;
	margin: 10px 50px 10px 20px
}

.toolbar {
	text-align:right;
	margin: 0px 10px 0px 10px
}

.copyright {
	padding-top: 30px;
	text-align:center;
	font-size:9px;
	color: #5F5F5F;
}

.small {
	font-size:9px;
}

.sforgelogo {
	text-align:right;
	height: 40px;
}

pre, .source {
	width:auto;
	border		: 1px solid #666;
	background	: #eee;
	margin		: 2em 4em;
	padding		: 1em 2em;
}

/*code {
	color		: #DB1416;
	
}*/
code { 
font-size: 1.2em;
font-family:courier,courier new,monospace;
background: #666666;
border-top: 0.03em solid #000;
border-right: 0.03em solid #000;
border-bottom: 0.03em solid #ccc;
border-left: 0.03em solid #ccc;
color: white;
}

blockquote{
  margin: 2em 5em ; 
 } 


</STYLE>

</HEAD>
<BODY BGCOLOR="green">
<A NAME="toptop"></A>
<DIV CLASS="header" ID="header">
<H1>Python Standard Library</H1>
<H2>翻译: Python 江湖群</H2>
<H3>2008-03-28 13:35:36</H3>
</DIV>

<DIV CLASS="body" ID="body">
<DIV CLASS="toc" ID="toc">
  <OL>
  <LI><A HREF="#toc1">工具和实用程序</A>
    <UL>
    <LI><A HREF="#toc2">1.1. dis 模块</A>
    <LI><A HREF="#toc3">1.2. pdb 模块</A>
    <LI><A HREF="#toc4">1.3. bdb 模块</A>
    <LI><A HREF="#toc5">1.4. profile 模块</A>
    <LI><A HREF="#toc6">1.5. pstats 模块</A>
    <LI><A HREF="#toc7">1.6. tabnanny 模块</A>
    </UL>
  </OL>

</DIV>
<P></P>
<HR NOSHADE SIZE=5>
<P></P>
<P>
<A HREF="index.html">返回首页</A>
</P>
<HR NOSHADE SIZE=5>
<P></P>
<A NAME="toc1"></A>
<H1><A href='#toptop'> 1. 工具和实用程序 </A></H1>
<P>
标准库中有一些模块既可用作模块又可以作为命令行实用程序.
</P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc2"></A>
<H2><A href='#toptop'> 1.1. dis 模块 </A></H2>
<P>
<CODE>dis</CODE> 模块是 Python 的反汇编器. 它可以把字节码转换为更容易让人看懂的格式.
</P>
<P>
你可以从命令行调用反汇编器. 它会编译给定的脚本并把反汇编后的字节代码输出到终端上: 
</P>
<PRE>
$ dis.py hello.py

          0 SET_LINENO              0

          3 SET_LINENO              1
          6 LOAD_CONST              0 ('hello again, and welcome to the show')
          9 PRINT_ITEM
         10 PRINT_NEWLINE
         11 LOAD_CONST              1 (None)
         14 RETURN_VALUE
</PRE>
<P></P>
<P>
当然 <CODE>dis</CODE> 也可以作为模块使用. <CODE>dis</CODE> 函数接受一个类, 方法, 函数, 或者 code 对象
作为单个参数. 如 <A HREF="#eg-11-1">Example 11-1</A> 所示.
</P>
<A NAME="eg-11-1"></A>
<H4><A href='#toptop'> 1.1.0.1. Example 11-1. 使用 dis 模块 </A></H4>
<PRE>
File: dis-example-1.py

import dis

def procedure():
    print 'hello'

dis.dis(procedure)

*B*          0 SET_LINENO          3

          3 SET_LINENO          4
          6 LOAD_CONST          1 ('hello')
          9 PRINT_ITEM
         10 PRINT_NEWLINE
         11 LOAD_CONST          0 (None)
         14 RETURN_VALUE*b*
</PRE>
<P></P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc3"></A>
<H2><A href='#toptop'> 1.2. pdb 模块 </A></H2>
<P>
<CODE>pdb</CODE> 模块是标准 Python 调试器( debugger ). 它基于 <CODE>bdb</CODE> 调试器框架.
</P>
<P>
你可以从命令行调用调试器 (键入 n <A HREF="next">或</A> 进入下一行代码, 
键入 help 获得可用命令列表):
</P>
<PRE>
$ pdb.py hello.py
&gt; hello.py(0)?()
(Pdb) n
&gt; hello.py()
(Pdb) n
hello again, and welcome to the show
--Return--
&gt; hello.py(1)?()-&gt;None
(Pdb)
</PRE>
<P></P>
<P>
<A HREF="#eg-11-2">Example 11-2</A> 展示了如何从程序中启动调试器.
</P>
<A NAME="eg-11-2"></A>
<H4><A href='#toptop'> 1.2.0.1. Example 11-2. 使用 pdb 模块 </A></H4>
<PRE>
File: pdb-example-1.py

import pdb

def test(n):
    j = 0
    for i in range(n):
        j = j + i
    return n

db = pdb.Pdb()
db.runcall(test, 1)

*B*&gt; pdb-example-1.py(3)test()
-&gt; def test(n):
(Pdb) s
&gt; pdb-example-1.py(4)test()
-&gt; j = 0
(Pdb) s
&gt; pdb-example-1.py(5)test()
-&gt; for i in range(n):
...*b*
</PRE>
<P></P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc4"></A>
<H2><A href='#toptop'> 1.3. bdb 模块 </A></H2>
<P>
<CODE>bdb</CODE> 模块为提供了一个调试器框架. 你可以使用它来创建自定义的调试器, 
如 <A HREF="#eg-11-3">Example 11-3</A> 所示.
</P>
<P>
你需要做的只是继承 <I>Bdb</I> 类, 覆盖它的 <CODE>user</CODE> 方法(在每次调试器停止的时候被调用). 
使用各种各样的 <CODE>set</CODE> 方法可以控制调试器.
</P>
<A NAME="eg-11-3"></A>
<H4><A href='#toptop'> 1.3.0.1. Example 11-3. 使用 bdb 模块 </A></H4>
<PRE>
File: bdb-example-1.py

import bdb
import time

def spam(n):
    j = 0
    for i in range(n):
        j = j + i
    return n

def egg(n):
    spam(n)
    spam(n)
    spam(n)
    spam(n)

def test(n):
    egg(n)

class myDebugger(bdb.Bdb):

    run = 0

    def user_call(self, frame, args):
        name = frame.f_code.co_name or "&lt;unknown&gt;"
        print "call", name, args
        self.set_continue() # continue

    def user_line(self, frame):
        if self.run:
            self.run = 0
            self.set_trace() # start tracing
        else:
            # arrived at breakpoint
            name = frame.f_code.co_name or "&lt;unknown&gt;"
            filename = self.canonic(frame.f_code.co_filename)
            print "break at", filename, frame.f_lineno, "in", name
        print "continue..."
        self.set_continue() # continue to next breakpoint

    def user_return(self, frame, value):
        name = frame.f_code.co_name or "&lt;unknown&gt;"
        print "return from", name, value
        print "continue..."
        self.set_continue() # continue

    def user_exception(self, frame, exception):
        name = frame.f_code.co_name or "&lt;unknown&gt;"
        print "exception in", name, exception
        print "continue..."
        self.set_continue() # continue

db = myDebugger()
db.run = 1
db.set_break("bdb-example-1.py", 7)
db.runcall(test, 1)

*B*continue...
call egg None
call spam None
break at C:\ematter\librarybook\bdb-example-1.py 7 in spam
continue...
call spam None
break at C:\ematter\librarybook\bdb-example-1.py 7 in spam
continue...
call spam None
break at C:\ematter\librarybook\bdb-example-1.py 7 in spam
continue...
call spam None
break at C:\ematter\librarybook\bdb-example-1.py 7 in spam
continue...*b*
</PRE>
<P></P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc5"></A>
<H2><A href='#toptop'> 1.4. profile 模块 </A></H2>
<P>
<CODE>profile</CODE> 模块是标准 Python 分析器.
</P>
<P>
和反汇编器, 调试器相同, 你可以从命令行调用分析器:
</P>
<PRE>
$ profile.py hello.py

hello again, and welcome to the show

         3 function calls in 0.785 CPU seconds

  Ordered by: standard name

  ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       1  0.001    0.001    0.002    0.002 &lt;string&gt;:1(?)
       1  0.001    0.001    0.001    0.001 hello.py:1(?)
       1  0.783    0.783    0.785    0.785 profile:0(execfile('hello.py'))
       0  0.000             0.000          profile:0(profiler)
</PRE>
<P></P>
<P>
如 <A HREF="#eg-11-4">Example 11-4</A> 所示, 我们还可以从程序中调用 <CODE>profile</CODE> 来对程序性能做分析.
</P>
<A NAME="eg-11-4"></A>
<H4><A href='#toptop'> 1.4.0.1. Example 11-4. U使用 profile 模块 </A></H4>
<PRE>
File: profile-example-1.py

import profile

def func1():
    for i in range(1000):
        pass

def func2():
    for i in range(1000):
        func1()

profile.run("func2()")

*B*        1003 function calls in 2.380 CPU seconds

  Ordered by: standard name

  ncalls  tottime  percall  cumtime  percall filename:lineno(function)
       1  0.000    0.000    2.040    2.040 &lt;string&gt;:1(?)
    1000  1.950    0.002    1.950    0.002 profile-example-1.py:3(func1)
       1  0.090    0.090    2.040    2.040 profile-example-1.py:7(func2)
       1  0.340    0.340    2.380    2.380 profile:0(func2())
       0  0.000             0.000          profile:0(profiler)*b*
</PRE>
<P></P>
<P>
你可以使用 <CODE>pstats</CODE> 模块来修改结果报告的形式.
</P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc6"></A>
<H2><A href='#toptop'> 1.5. pstats 模块 </A></H2>
<P>
<CODE>pstats</CODE> 模块用于分析 Python 分析器收集的数据. 如 <A HREF="#eg-11-5">Example 11-5</A> 所示.
</P>
<A NAME="eg-11-5"></A>
<H4><A href='#toptop'> 1.5.0.1. Example 11-5. 使用 pstats 模块 </A></H4>
<PRE>
File: pstats-example-1.py

import pstats
import profile

def func1():
    for i in range(1000):
        pass

def func2():
    for i in range(1000):
        func1()

p = profile.Profile()
p.run("func2()")

s = pstats.Stats(p)
s.sort_stats("time", "name").print_stats()

*B*         1003 function calls in 1.574 CPU seconds

   Ordered by: internal time, function name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     1000    1.522    0.002    1.522    0.002 pstats-example-1.py:4(func1)
        1    0.051    0.051    1.573    1.573 pstats-example-1.py:8(func2)
        1    0.001    0.001    1.574    1.574 profile:0(func2())
        1    0.000    0.000    1.573    1.573 &lt;string&gt;:1(?)
        0    0.000             0.000          profile:0(profiler)*b*
</PRE>
<P></P>
<HR NOSHADE SIZE=1>
<P></P>
<A NAME="toc7"></A>
<H2><A href='#toptop'> 1.6. tabnanny 模块 </A></H2>
<P>
(2.0 新增) <CODE>tabnanny</CODE> 模块用于检查 Python 源文件中的含糊的缩进. 
当文件混合了 tab 和空格两种缩进时候, nanny (保姆)会立即给出提示.
</P>
<P>
在下边使用的 <CODE>badtabs.py</CODE> 文件中, if 语句后的第一行使用 4 个空格和 1 个 tab . 
第二行只使用了空格.
</P>
<PRE>
$ tabnanny.py -v samples/badtabs.py
';samples/badtabs.py': *** Line 3: trouble in tab city! ***
offending line:         print "world"

indent not equal e.g. at tab sizes 1, 2, 3, 5, 6, 7, 9
</PRE>
<P></P>
<P>
因为 Python 解释器把 tab 作为 8 个空格来处理, 所以这个脚本可以正常运行. 
在所有符合代码标准(一个 tab 为 8 个空格)的编辑器中它也会正常显示. 
当然, 这些都骗不过 nanny .
</P>
<P>
<A HREF="#eg-11-6">Example 11-6</A> 展示了如何在你自己的程序中使用 <CODE>tabnanny</CODE> .
</P>
<A NAME="eg-11-6"></A>
<H4><A href='#toptop'> 1.6.0.1. Example 11-6. 使用 tabnanny 模块 </A></H4>
<PRE>
File: tabnanny-example-1.py

import tabnanny

FILE = "samples/badtabs.py"

file = open(FILE)
for line in file.readlines():
    print repr(line)

# let tabnanny look at it
tabnanny.check(FILE)

*B*'if 1:\012'
'    \011print "hello"\012'
'        print "world"\012'
samples/badtabs.py 3 '        print "world"'\012'*b*
</PRE>
<P></P>
<P>
将 <CODE>sys.stdout</CODE> 重定向到一个 <CODE>StringIO</CODE> 对象就可以捕获输出.
</P>
<HR NOSHADE SIZE=5>
<P></P>
</DIV>

<!-- html code generated by txt2tags 2.4 (http://txt2tags.sf.net) -->
<!-- cmdline: txt2tags chapter11.t2t -->
</BODY></HTML>
